\documentclass[pdftex,ptm,12pt,a4paper]{report}
\renewcommand{\baselinestretch}{1.5}
\setcounter{secnumdepth}{5}
\usepackage[english, russian]{babel}

% PDF search & cut'n'paste
\usepackage{cmap}
\usepackage[table,xcdraw]{xcolor}
\renewcommand{\baselinestretch}{1.5} 
\usepackage{setspace}
\usepackage{indentfirst}

% Cyrillic support
\usepackage{mathtext}
\usepackage{cleveref}
\usepackage{amsmath}
\usepackage[T1,T2A]{fontenc}
\DeclareSymbolFont{T2Aletters}{T2A}{cmr}{m}{it}
\usepackage[utf8]{inputenc}
\usepackage{multicol}

\usepackage[bottom=30mm,top=20mm,right=20mm,left=30mm,headsep=0cm,nofoot]{geometry}

\usepackage{calc}
\setlength{\footskip}{\paperheight
  -(1in+\voffset+\topmargin+\headheight+\headsep+\textheight)
  -0.75in}

\usepackage{array}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\makeatletter
\renewcommand*{\ps@plain}{%
  \let\@mkboth\@gobbletwo
  \let\@oddhead\@empty
  \def\@oddfoot{%
    \reset@font
    \hfil
    \thepage
    % \hfil % removed for aligning to the right
  }%
  \let\@evenhead\@empty
  \let\@evenfoot\@oddfoot
}
\makeatother
\pagestyle{plain}

\usepackage[pdftex]{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage[russian,english]{babel}
    \addto{\captionsenglish}{\renewcommand{\bibname}{Литература}}
    \addto\captionsenglish{\renewcommand{\figurename}{Рис.}}
    \addto\captionsenglish{\renewcommand{\contentsname}{Содержание}}
    \addto\captionsenglish{\renewcommand{\proofname}{Доказательство}}
\usepackage{hyperref}
\usepackage{url}
\usepackage{abstract}
\usepackage{float}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{amsmath}
\renewcommand*{\proofname}{Доказательство}
\usepackage{indentfirst}
\usepackage{color}
\usepackage{natbib}
\usepackage{bbm, dsfont}


% Detect whether PDFLaTeX is in use
\usepackage{ifpdf}

% Fix links to floats
\usepackage[all]{hypcap}

\makeatletter
\renewcommand{\@chapapp}{Часть}
\makeatother

% Theorem Styles
\newtheorem{theorem}{Теорема}[chapter]
\newtheorem{lemma}[theorem]{Лемма}
\newtheorem{claim}[theorem]{Теорема}
% Definition Styles
\theoremstyle{definition}
\newtheorem{definition}{Определение}[chapter]
\newtheorem{example}{Пример}[chapter]
% Rule for Title Page
\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}

\begin{document}

\begin{titlepage}
\newpage

\begin{center}
МИНИСТЕРСТВО ОБРАЗОВАНИЯ И НАУКИ РОССИЙСКОЙ ФЕДЕРАЦИИ \\
\vspace{0.5cm}
ГОСУДАРСТВЕННОЕ ОБРАЗОВАТЕЛЬНОЕ УЧРЕЖДЕНИЕ \\*
ВЫСШЕГО ПРОФЕССИОНАЛЬНОГО ОБРАЗОВАНИЯ\\*
"МОСКОВСКИЙ ФИЗИКО-ТЕХНИЧЕСКИЙ ИНСТИТУТ \\*
(ГОСУДАРСТВЕННЫЙ УНИВЕРСИТЕТ)" \\*
\vspace{0.5cm}
ФАКУЛЬТЕТ ИННОВАЦИЙ И ВЫСОКИХ ТЕХНОЛОГИЙ \\*
КАФЕДРА АНАЛИЗА ДАННЫХ \\*
\hrulefill
\end{center}


\vspace{3em}

\begin{center}
\Large Выпускная квалификационная работа по направлению 01.03.02 <<Прикладная математика и информатика>> \linebreak НА ТЕМУ:
\end{center}

\vspace{2.5em}

\begin{center}
\textsc{\large{\textbf{НЕЙРОСЕТЕВЫЕ МОДЕЛИ В ЗАДАЧАХ ИНТЕРПРЕТАЦИИ ДАННЫХ ФМРТ ПРИ АУДИАЛЬНОЙ СТИМУЛЯЦИИ}}}
\end{center}

\vspace{6.5em}

\begin{minipage}{.45\linewidth}
\begin{flushleft}                           
Студентка \\ Научный руководитель к.ф-м.н \\ Зам. зав. кафедрой д.ф-м.н, проф. 
\end{flushleft} 
\end{minipage}
\hfill
\begin{minipage}{.45\linewidth}
\begin{flushright}                                      
Медведева А.Е.\\ Артемов А.В.\\Бунина Е.И.
\end{flushright} 
\end{minipage}

\vspace{\fill}

\begin{center}
МОСКВА, 2017
\end{center}

\end{titlepage}

\tableofcontents
\sloppy

\setstretch{1.5}
\parindent=1.25cm

\chapter{Введение}
\section{История исследования мозга}

Проблема исследования мозга человека, соотношения мозга и психики - одна из самых захватывающих задач, которые когда-либо возникали в науке. Ведь все, что до сих пор исследовалось - и атом, и галактика, и мозг животного - было проще, чем мозг человека. С философской точки зрения неизвестно, возможно ли в принципе решение этой задачи. Ведь, кроме приборов и методов, главным средством познания мозга остается опять-таки наш человеческий мозг. Обычно прибор, который изучает какое-то явление или объект, сложнее этого объекта, в этом же случае мы пытаемся действовать на равных - мозг против мозга.

В прошлом веке были обнаружены зоны мозга, отвечающие за речь, - по имени открывателей их называют области Брока и Вернике (см. \ref{broc_vernike}). Были сделаны великие открытия, но возможности методик того времени для изучения человеческих функций весьма ограничены: психологические тесты, клинические наблюдения и начиная с тридцатых годов электроэнцефалограмма.

Прорыв в понимании правого полушария произошел в 1960-х годах, когда Роджер Сперри обнаружил, что правое полушарие мозга просто обрабатывало информацию по-разному: где левая сторона обрабатывала информацию последовательно, правая часть обрабатывала ее более сложноустроенным способом; где левая сторона распознает имя человека, правая сторона распознает их лицо; где левая сторона хороша в логике и анализе, правая сторона имеет логичный смысл, распознает узоры и интерпретирует эмоции и невербальные выражения.

Также в 1960-х годах невролог Пол Маклин изучал эволюцию человеческого мозга. Он пришел к выводу, что в нашем черепе не один мозг, а три, каждый из которых представляет собой отдельный эволюционный слой, который сформировался на более старом слое перед ним.

В последнее время технология сканирования ФМРТ позволила нейробиологам понять, что, хотя в мозге без сомнений есть области, специализированные для обработки определенных типов информации, несколько частей мозга вовлечены практически во все, что мы делаем. Этот прорыв позволил нам понять, что наши мысли и характер определяются меньше самими мозговыми областями, но больше относительной силой связи нейронных сетей, которые их соединяют.

\section{ФМРТ в измерении активности мозга}

Функциональная магнитно-резонансная томография, или ФМРТ, - это метод измерения активности головного мозга. Он работает путем обнаружения изменений насыщения крови кислородом, а также изменение кровотока, возникающего в ответ на нейронную активность. Когда зона мозга более активна, она потребляет больше кислорода, и чтобы удовлетворить этот растущий спрос, увеличивается приток крови к рабочей области. ФМРТ может быть использована для создания карт активности, показывающих, какие части мозга вовлечены в конкретный психический процесс.

Каждое ФМРТ измерение -- последовательность трехмерных сканов мозга, где каждый скан есть набор значений сигнала на каждом маленьком участке мозга, называемым вокселем и представляющим собой параллелепипед с сторонами порядка нескольких милиметров (см. \ref{fmri_result}).

\begin{figure}[h]
\includegraphics[scale=0.25]{images/fmrt_result.png}
\centering
\caption{ФМРТ измерение.}
\label{fmri_result}
\end{figure}

ФМРТ имеет несколько преимуществ перед другими методами измерения мозговой активности:
\begin{enumerate}
\item Этот метод является неинвазивным и не использует рентгеновское излучение, что делает его безопасным для человека.

\item Имеет хорошую пространственно-временное разрешение. На рисунке \ref{fmri} показано сравнение ФМРТ с другими методами измерения активности мозга, такими как энцефалография(МЭГ, ЭЭГ) и позитронно-эмисионная томография (ПЭТ).

\begin{figure}[h]
\includegraphics[scale=0.35]{images/fmrt.jpg}
\centering
\caption{Сравнение ФМРТ, ПЭТ и МЭГ.}
\label{fmri}
\end{figure}

\item Его легко использовать для постановки экспериментов и далее анализировать (см. \cite{abraham2014machine}).
\end{enumerate}

Из недостатков можно выделить следующие:

\begin{enumerate}
\item Для точного измерения необходимо, чтобы человек оставался неподвижным. Движения головы, вызванные биением сердца и дыханием, являются одним из основных источников шума.

\item Наличие шума, вызванного неоднородностью магнитного поля, используемого для измерения.

\item ФМРТ измеряет уровень активности не напрямую, а косвенно.

\item Уровень насыщения крови кислородом, который измеряет ФМРТ, изменяется очень медленно. Его изменение происходит с некоторой задержкой (обычно порядка пары секунд), так как необходимо некоторое время для реакции сосудистой системы в ответ на потребность мозга в глюкозе. После чего уровень сигнала обычно поднимается до пика примерно через 5 секунд после стимула. Если нейроны остаются активными, пик распространяется на плоское плато. После остановки деятельности, сигнал падает ниже исходного уровня -- явление, называемое недолетом. С течением времени сигнал восстанавливается до базовой линии (см. \ref{hrf}). 

\begin{figure}[h]
\includegraphics[scale=0.45]{images/hrf.png}
\centering
\caption{Уровень насыщения крови в зависимости от времени.}
\label{hrf}
\end{figure}

\end{enumerate}

\section{Функции зон мозга} \label{zones_function}

В головном мозге человека ученые выделяют три основные части: задний мозг, средний мозг и передний мозг. Исторически более древними считаются задний и средний мозг. Они отвечают за жизненно важные внутренние функции организма: поддержание тока крови, дыхание. За человеческие формы коммуникации с внешним миром (мышление, память, речь) отвечает передний мозг, он и будет рассмотрен далее.

В коре головного мозга можно выделить четыре доли: затылочную, теменную, височную и лобную. В соответствии с принципом латерализации -- разделения по полушариям — каждая доля имеет свою пару (см. \ref{mozg}).

\begin{figure}[h]
\includegraphics[scale=0.45]{images/mozg.png}
\centering
\caption{Зоны мозга человека.}
\label{mozg}
\end{figure}

Лобные доли можно условно назвать командным пунктом головного мозга. Здесь находятся центры, не столько отвечающие за отдельное действие, сколько обеспечивающие такие качества, как самостоятельность и инициативность человека, его способность к критической самооценке. 
Поражение лобных долей вызывает появление беззаботности, бессмысленных устремлений, переменчивости и склонности к неуместным шуткам. 
С утратой мотивации при атрофии лобных долей человек становится пассивным, теряет интерес к происходящему, часами остается в постели.
Нередко  окружающие принимают такое поведение за леность, 
не подозревая, что изменения в поведении есть прямое следствие гибели 
нервных клеток этой зоны коры головного мозга.

Функции, выполняемые теменными долями, отличаются для доминирующей и недоминирующей сторон. Доминирующая сторона (обычно левая) отвечает за способность понимать устройство целого через соотнесение его частей (их порядок, структуру) и за наше умение складывать части в целое. Это относится к самым разным вещам. Например, для чтения необходимо уметь складывать буквы в слова и слова во фразы. То же с цифрами и числами. Недоминантная сторона (обычно правая) – это центр, который, комбинируя информацию, поступающую из затылочных долей, обеспечивает трехмерное восприятие окружающего мира. Нарушение этой области коры приводит к зрительной агнозии – неспособности распознавать предметы, лица, окружающий пейзаж.

Затылочные доли отвечают за переработку зрительной информации. По сути, все, что мы видим, мы видим не глазами, которые лишь фиксируют раздражение воздействующего на них света и переводят его в электрические импульсы. Мы «видим» затылочными долями, которые интерпретируют поступающие от глаз сигналы. Зная об этом, необходимо отличать у пожилого человека ослабление остроты зрения от проблем, связанных с его способностью воспринимать предметы. Острота зрения (способность видеть мелкие объекты) зависит от работы глаз, восприятие – продукт работы затылочной и теменной долей мозга. Информация о цвете, форме, движении обрабатывается отдельно в затылочной доле коры, прежде чем будет принята в теменной доле для превращения в трехмерное представление. 

\begin{figure}[h]
\includegraphics[scale=0.4]{images/brain_anatomy.jpg}
\centering
\caption{Области Брока, Вернике и Хеши, важные для обработки устной речи.}
\label{broc_vernike}
\end{figure}

Височные доли в верхних отделах обрабатывают слуховые ощущения, превращая их в звуковые образы. Поскольку слух – это канал, по которому человеку передаются звуки речи, височные доли (особенно доминантная левая) играют важнейшую роль в обеспечении речевой коммуникации.
Именно в этой части мозга производится распознавание и наполнение смыслом обращенных к человеку слов, а также подбор единиц языка для выражения собственных смыслов. Недоминантная доля (правая у правшей) участвует в распознавании интонационного рисунка и выражения лица. 
Небольшой участок на внутренней поверхности височных долей, имеющий форму морского конька (гиппокамп), контролируетдолговременную память человека. Именно височные доли хранят наши воспоминания. Доминантная (обычно левая) височная доля имеет дело с вербальной памятью и названиями объектов, недоминантная используется для зрительной памяти.

Также в височной зоне недавно был найден участок (см.\cite{kikuchi2017sequence}), называемый извилина Hоschi, общий у людей и обезьян, в котором происходят процессы, участвующие в обработке речи и предсказании слова, которое вот-вот прозвучит (см. \ref{broc_vernike}). По словам исследователей, фактически обнаруженные механизмы речи в мозге человека работают как предиктивный ввод текста в мобильном телефоне, предвосхищая то, что вы сейчас услышите.

\chapter{Обзор литературы}
\section{Семантический атлас мозга}\label{complex}

\begin{figure}[h]
\includegraphics[scale=0.4]{images/galant_results.png}
\centering
\caption{Результаты из работы \cite{huth2016natural}.}
\label{huth_result}
\end{figure}

Работа \cite{huth2016natural} группы американских нейробиологов посвящена созданию семантического атласа мозга на основе данных, полученных с помощью ФМРТ. Ученым удалось выделить области на фронтальной коре, ответственные за конкретные семантические группы, такие как социальные явления, абстрактные понятия, количественные слова. 

\begin{figure}[h]
\includegraphics[scale=0.37]{images/map_result_huth.png}
\centering
\caption{Результаты из работы \cite{huth2016natural}.}
\label{map_huth_result}
\end{figure}

Эксперимент был построен следующим образом: 8 испытуемых слушали 2 часа рассказы из радиопередачи. После чего авторы подсчитали на большом корпусе матрицу совместной встречаемости каждого слова из текста аудио и 985 самых часто употребляемых английских слов. Каждая строка этой матрицы соответствовала представлению слова из аудио в 985-мерном пространстве. Для установления зависимости между признаками аудиостимула (представления слов из аудио) и измерениями ФМРТ авторы использовали гребневую регрессию. 
Далее изучались вектора весов регрессии, соответствующей каждому вокселю, для чего они были спроектированы в четырехмерное пространство с помощью метода главных компонент. В это же пространство были спроектированы и слова из аудиостимула. 
С помощью алгоритма k средних спроецированные слова были сгруппированы в 12 категорий. После чего авторы раскрасили пространство из первых трех главных векторов и визуализировали результат (см. \ref{huth_result}). 

Интересна проекция на первую компоненту: положительные знак имеют слова, относящиеся к человеку и человеческим взаимодействиям, отрицательную -- описания восприятия, местоположения, количества. На рис. \ref{map_huth_result} показана средняя корреляция Пирсона в проекции на поверхность долей. Видно, что зоны LTC, VTC, LPC, MPC, SPFC и IPFC предсказываются достаточно хорошо (корреляция значимо больше нуля), ранее эти зоны считались семантической системой мозга.

Также интересно, что височные зоны, отвечающие за анализ слуховой информации, более всего реагируют на слова из социальной группы (см. \ref{gallant_visoc}).

\begin{figure}[h]
\includegraphics[scale=0.3]{images/gallant_view1.png}
\centering
\caption{Результаты из \cite{huth2016natural}.}
\label{gallant_visoc}
\end{figure}

\section{Применение нейросетевых методов}

\begin{figure}[h]
\includegraphics[scale=0.3]{images/lstm.png}
\centering
\caption{Схема эксперимента из \cite{qian2016bridging}.}
\label{ch_experiment}
\end{figure}

В статье \cite{qian2016bridging} изучалось предсказательная способность LSTM юнитов в зависимости от архитектуры (наличия гейтов). Эксперимент был устроен следующим образом: в течение 45 несколько человек равномерно (со скоростью появление слов - 1 слово каждый полсекунды) читали главу из книги "Гарри Поттер".

Далее авторы обучили на оставшихся главах нейронную сеть, состоящую из одного скрытого слоя  размерности 100, предсказывать следующее слово в тексте. Затем с помощью метода наименьших квадратов устанавливалась зависимость между вектором внутреннего состояния нейросети $a_t$ в момент предсказывания следующего слова и вектором активации всего мозга перед прочтением этого слова (см \ref{ch_experiment}):
$$ y_t = M a_t, a_t \in \{c_t, h_t\}.$$
В качестве вектора внутреннего состояния сети $a_t$ может служить как вектор памяти lstm юнитов $c_t$, так в "внешнее" внутреннее состояние $h_t$ - те значения, которые рекуррентный слой передает полносвязному.
Мерой качества модели авторы использовали косинусное расстояние между предсказанием и действительной активацией мозга, нормализованным на отрезок [0,1]. Несмотря на то, что статья была посвящена изучению LSTM юнитов, авторы получили неплохую предсказательную способность (см. \ref{qian_res}), максимальное качество 0.86 достигалось при максимально возможном окне просмотра на тесте и использовании вектора внутренней памяти сети.

\begin{figure}[h]
\includegraphics[scale=0.7]{images/neural_nets.png}
\centering
\caption{Результаты из работы \cite{qian2016bridging}.}
\label{qian_res}
\end{figure}

\section{Мотивация исследования}

В статье \cite{hanke2014high} отсутствуют результаты для альтернативных семантических представлений, например word 2 vec. Также интерес представляет возможность ли воспроизвести результаты для другого языка и других параметрах эксперимента.
В статье \cite{qian2016bridging} целью являлось исследование LSTM сетей, а не точность предсказания мозгового аудиостимула, также стимул в эксперименте был ваизуальный и слова появлялись на экране равномерно.

\chapter{Цель работы}

\section{Постановка задачи}

В типичном эксперименте с помощью ФМРТ по внешнему стимулу строится матрица признаков $\textbf{X}.$ Например, при аудиальной стимуляции строки матрицы $\textbf{X}$ -- векторы, соответствующие словам из текста аудио. Измерения ФМРТ -- матрица ответов $\textbf{Y},$ столбцы которой соотвествуют вокселям, строки -- вектор активации мозга в конкретный момент времени. Далее задача сводится к построению модели $f,$ максимизирующую корреляцию Пирсона на тестовой выборке:
$$Pearson(\textbf{Y}_{test},\ f(\textbf{X}_{test})) \rightarrow max_{f}.$$

В случае, если для каждого вокселя своя модель из класса $\mathcal{F}$, то максимизируется средняя корреляция по вокселям. Обозначим число вокселей за $N$, $i$--ый столбец матрицы $\textbf{Y}$ за $\textbf{Y}^{;,i}$. Тогда функционал для максимизации выглядит следующим образом:

$$\frac{1}{N} \sum_{i=1}^{N} Pearson(\textbf{Y}_{test}^{:,i}, f_{i}(\textbf{X}_{test})) \rightarrow max_{\mathcal{F}}.$$

Нетрудно убедится в том, что при нормализованном отклике данная задача максимизиции эквивалентна минимизации средней квадратичной ошибки между предсказанием и действительным откликом. Обозначим $\hat{Y} = f(\mathbf{X}_{test}), Y = \hat{Y} + \epsilon,$ где $\hat{Y}$ независим от $\epsilon$. Учитывая, что $\sigma^2_{Y} = \sigma^2_{\hat{Y}} + \sigma^2_{\epsilon}$, получаем:

$$Pearson(Y, \hat{Y})^2 = \frac{cov^2(Y, \hat{Y})}{\sigma^2_{Y}\sigma^2_{\hat{Y}}} =  \frac{cov(\hat{Y} + \epsilon, \hat{Y})\ cov(\hat{Y} + \epsilon, \hat{Y})}{\sigma^2_{Y}\sigma^2_{\hat{Y}}} = \frac{\sigma^4_{\hat{Y}}}{\sigma^2_{Y}\sigma^2_{\hat{Y}}} = $$

$$= \frac{\sigma^2_{\hat{Y}}}{\sigma^2_{Y}} = \frac{\sigma^2_{Y} - \sigma^2_{\epsilon}}{\sigma^2_{Y}} = 1 - \frac{MSE(Y, \hat{Y})}{\sigma^2_{Y}}.$$


\section{Цель и задачи исследования}

Целью исследование является разработка и исследование
математической модели, алгоритмов и комплексов
программ для интерпретации данных ФМРТ при
аудиальной стимуляции. Более конкретно, задачи исследования являются:
\begin{enumerate}
\item Независимое воспроизведение линейной повоксельной модели ФМРТ-отклика на аудиальный стимул, в том числе:
\begin{itemize}
\item Создание экспериментальной среды, допускающей
легкую воспроизводимость исследования.
\item Попытка использования предобученного word 2 vec в предсказании ФМРТ отклика.
\item Сравнение семантических групп с результатами, полученными для английского языка.
\end{itemize}
\item Разработка нелинейной нейросетевой повоксельной
модели ФМРТ-отклика на аудиальный стимул, в том числе:
\begin{itemize}
\item Попытка применения рекуррентных сетей для предсказания ФМРТ отклика.
\item Использование семантических предскавлений на основе рекуррентных сетей.
\item Сравнение линейных и нелинейных моделей.
\end{itemize}
\end{enumerate}

\chapter{Методы исследования}
Пусть $\mathbf{X}$ -- матрица признаков, $\vec{y}$ -- вектор ответов. 
Опишем модели, используемые в работе.
\begin{enumerate}
\item Гребневая регрессия. Предполагаем, что $\vec{y} = \mathbf{X}\vec{w} + \vec{\epsilon},$ где $\vec{\epsilon} \sim N(0, \sigma^2I)$,\\ $\vec{w} \sim N(0,\frac{\sigma^2}{\alpha}I)$. Оптимизационная задача тогда выглядит следующим образом:
\[
\vec{w}^{*} = \underset{\vec{w}}{\operatorname{argmin}}(||\vec{y} - \mathbf{X}
\vec{w}||^{2} + \alpha ||\vec{w}||^2),
\]
ее решение:
\[
\hat{\vec{w}} = (\mathbf{X}^{T}\mathbf{X} + \alpha I)^{-1}\mathbf{X}^{T}\vec{y}.
\]

\item Полносвязные нейронные сети.
Главной частью нейронных сетей является искусственный нейрон (\cite{rosenblatt1958perceptron}). Он был создан по подобию человеческого нейрона (см \ref{fc_unit}), который принимает сигналы по дендритам, обрабатывает их и передает сигнал по аксону другим нейронам. Архитектура искусственного нейрона весьма проста: принимая на входе вектор $\vec{x}$, он возвращает $f(\vec{x}) = \sigma(\sum_{i=1}^n w_i x_i),$ где $\sigma$ -- некоторая нелинейная функция активации, например, сигмоида: $\sigma(x) = \frac{1}{1 + e^{-x}}.$

\begin{figure}[h]
\includegraphics[scale=0.6]{images/fc_unit.png}
\centering
\caption{Архитектура искусственного нейрона.}
\label{fc_unit}
\end{figure}

\item Рекуррентные нейронные сети.
\begin{itemize}
\item LSTM-модуль это рекуррентный модуль сети (\cite{graves2005framewise}), способный запоминать значения как на короткие, так и на длинные промежутки времени. Ключом к данной возможности является то, что LSTM-модуль не использует функцию активации внутри своих рекуррентных компонентов. Таким образом, хранимое значение не размывается во времени, и градиент или штраф не исчезает при использовании метода обратного распространения ошибки во времени (Backpropagation through time) при тренировке сети (см. \ref{lstm_unit}).

\begin{figure}[h]
\includegraphics[scale=0.4]{images/Long_Short_Term_Memory.png}
\centering
\caption{Архитектура LSTM юнита.}
\label{lstm_unit}
\end{figure}

\item GRU - механизм в рекуррентных нейронных сетях, также использующий ворота (gates), чтобы управлять потоком информации внутри себя, однако имеет меньше параметров, чем LSTM, ввиду того что не имеет отделенную клетку памяти (memory cell), (см.\cite{chung2014empirical}).
\end{itemize}

\item Метод главных компонент - один из основных способов уменьшить размерность данных, потеряв наименьшее количество информации. Пусть матрица $X$ имеет размерность $n, k.$ Для этого решаем задачу нахождения таких чисел $Z = (z_{ij}), i=1,\ldots, n, j=1,\ldots,m$ и $U = (u_{ij}), i = 1\ldots k, j=1\ldots m, m < n$ чтобы:
$$\hat{X_i} = \sum_{l=1}^{m}z_l u_{jl}$$ был как можно ближе к $X_i.$ Получаем задачу оптимизации: 
$$ \sum_{i=1}^{k} ||X_j - \hat{X}_j||^2 = || ZU^{T} - X||^2 \longrightarrow \underset{Z, U}{\operatorname{min}}.$$ Ее решение: матрица $U$, такая что ее столбцы являются собственными векторами матрицы $X^{T}X,$ соответствующие первым $m$ наибольшим собственным значениям, а $Z = XU.$
\end{enumerate}

\chapter{Эксперимент}

\section{Описание данных}

Данные были взяты с открытой базы данных ФМРТ openfmri.org (см. \citep{hanke2014high}). В ходе эксперимента 20 носителей немецкого языка в возрасте от 21 до 38 лет 2 часа (8 сегментов по 15 минут) слушали немецкий аудиофильм "Форрест Гамп", версия для слабовидящих. Данная версия отличается от обычной тем, что в моменты, когда нет диалогов, голос за кадром описывает, что происходит на экране. При этом ФМРТ сканер измерял каждые две секунды мозговую активность с пространственным разрешением $2.75\ mm^3$.

\section{Препроцессинг данных}

К данным ФМРТ была применена коррекция движений а также подавление шума с помощью библиотеки FLIRT, затем ФМРТ сигнал был посегментно нормализан, чтобы иметь среднее ноль и дисперсию 1. 

\begin{figure}[h]
\includegraphics[scale=0.5]{images/word_forrest.png}
\centering
\caption{Визуализация эксперимента.}
\label{interpolation}
\end{figure}

Для дальнейшего работы необходимо знать точное соответствие каждого слова из транскрипции аудио и момента его произношения (выравнивание транскрипции). Так как транскрипция отсутствовала, она создавалась самостоятельно. Сначала на основе описания сцен и субтитров создавалась фразовая транскрипция аудио. Далее каждая фраза и соответствующий фрагмент аудио подавалась на вход библиотеке aeneas, которая выдавала для каждого слова из фразы соответствующий ему момент в аудио. Также был испробован инструмент Google Api Speech Recognition для того чтобы создать более точную версию субтитров, однако данный подход оказался несколько хуже ввиду ошибок распознавания.

Далее с помощью предобученной модели word to vec слова из транскрипции были переведены в трехсотмерные вектора из $\mathbb{R}^{300}.$ Затем полученные представления слов интерполировались с ядром Ланшица, чтобы согласовать моменты произношения слов и моменты измерения ФМРТ (см. \ref{interpolation}). Ввиду того что отклик конкретного вокселя происходит с некоторой задержкой, а также ввиду сложной формы сигнала отклика (\ref{hrf}), для каждого момента измерения стимул, соответствующий этому моменту, был сконкатенирован с тремя предыдущими (см. \ref{schema}). Таким образом получилось 1200 семантических признаков. Далее из 3600 пар стимул - измерение первые 3100 использовались для обучения и последние 500 для валидации.

\begin{figure}[h]
\includegraphics[scale=0.4]{images/schema.png}
\centering
\caption{Схема построения пространства признаков.}
\label{schema}
\end{figure}

\section{Линейные методы}

Повторяя эксперимент авторов статьи \citep{huth2016natural} а также избегая переобучения ввиду большого числа признаков и относительно малого числа данных, мы использовали повоксельно гребнеую регрессию для предсказания ФМРТ отклика.

\begin{figure}[h]
\includegraphics[scale=0.7]{graphics/correlations2.png}
\centering
\caption{Корреляция на тесте в зависимости от параметра $\alpha$ }
\label{corr_many}
\end{figure}

На рисунке \ref{corr_many} показаны результататы корреляции на тесте в зависимости от параметра регулязации альфа гребневой регрессии для 6 человек. На первом графике показана средняя повоксельная корреляция, на втором -- разница числа вокселей, корреляция которых больше 0.2 и числа вокселей, корреляция которых меньше -0.2. По графику видно, что оптимальные значения параметра альфа примерно одного порядка и средняя корреляция стабильно больше нуля. Также оптимальное значение параметра альфа в статье \cite{huth2016natural} равняется 185, что примерно соответствует графикам. Далее для каждого субъекты выбиралась свое оптимальное значение параметра альфа, при этом общее для всех вокселей данного человека.

На рисунке \ref{sub3_hist} показана гистограмма корреляций вокселей для третьего испытуемого. Видно, что положительных значений больше и среднее значимо отличается от нуля. 
Критерии согласия Колмогорова для проверки на нормальность показывает p-value равным 0, что означает что данное распределение нельзя считать нормальным. Также критерий Вилконсона для проверки на симметричность относительно нуля также дает p-value равным 0.

\begin{figure}[h]
\includegraphics[scale=0.6]{graphics/sub3_prep2.png}
\centering
\caption{Гистограмма корреляций при $\alpha=245$.}
\label{sub3_hist}
\end{figure}

\begin{figure}[h]
\includegraphics[scale=0.5]{graphics/sub3_prep2_bestvoxel.png}
\centering
\caption{Отклик вокселя и его предсказание.}
\label{sub3_bv}
\end{figure}

\begin{figure}[h]
\includegraphics[scale=0.65]{graphics/sub12_trunk01.png}
\centering
\caption{Значимые результаты предсказания (корреляция > 0.1) для 12-ого субъекта.}
\label{sub12_mosaic}
\end{figure}

\begin{figure}[h]
\includegraphics[scale=0.4]{images/all_6.png}
\centering
\caption{Срезы карты корреляции ФМРТ отклика и предсказания.}
\label{slices}
\end{figure}

\begin{figure}[h]
\includegraphics[scale=0.4]{images/all6_3d.png}
\centering
\caption{Карта корреляции ФМРТ отклика и предсказания.}
\label{slices_3d}
\end{figure}

На рисунке \ref{sub3_bv} показан пример типичного сигнал ФМРТ на тесте и его предсказания, нормализованные для наглядности. В целом график выглядит оптимистично, и убеждает в том, что обладает хорошей предсказательной способностью.

Посчитав для каждого вокселя результат корреляции на тесте и записав полученные результаты в трехмерный тензор, можно визуализировать карты результатов модели. На рисунке \ref{sub12_mosaic} показаны последовательные срезы такой карты по оси z для одного и того же человека. Примечательно, что лучше всего для него предсказывается доминантная височная зона (для праворукого - левая), которая отвечает за наполнение смыслом обращенных к человеку слов.
 
На рисунке \ref{slices},  показаны срезы на одном и том же уровне по оси z  для шести различных субъектов, на \ref{slices_3d} их 3d модели. В целом карты приблизительно повторяют друг друга: хорошо предсказываются височные доли (корреляция достигает 0.4 для всех субъектов), на рисунке \ref{gallant_visoc} эти зоны больше всего реагируют на слова из социальной группы.


\subsection{Анализ весов гребневой регрессии}
После применения гребневой регрессии для каждого вокселя получилось 1200 весов $\vec{v}_{old} \in \mathbb{R}^{1200}$. Эти веса были обратно усреднены по представлениям таким образом, чтобы получить 300 мерные вектора:
$$\vec{w} = \frac{1}{4}\ [(v_1, \ldots, v_{300})^{T} + (v_{301}, \ldots, v_{600})^{T} + (v_{601}, \ldots, v_{900})^{T} + (v_{901}, \ldots, v_{1200})^{T}].$$
Далее для хорошо предсказываемых вокселей искались слова из аудиостимула, косинусное расстояние между представлением которых максимально с весами данного вокселя, что эквивалентно максимизации значения отклика в семантическом пространстве аудиостимула.

Интересно, например, что если брать два вокселя с одинаковыми координатами у двух разных человек и сравнивать топ из 20 слов, то у многих зон есть ненулевое пересечение. Например, для зоны на рисунке (\ref{voxel_to_choose}) следующее  пересечение:

\begin{itemize}
\item wirklich - собственно, в сущности, на самом деле
\item eigentlich - действительно, в самом деле, право
\item ja - да, конечно, обязательно
\item jawohl -  да, конечно, совершенно верно
\item aber - однако, только, же
\item solltest - должен, быть должным, быть обязанным, следовать, надлежать
\item tust - делать, творить, учинить
\item wirst - становиться, стать, делаться, превращаться
\end{itemize}

\begin{figure}
\centering
\includegraphics[scale=0.5]{images/voxel_to_choose1.png} 
\includegraphics[scale=0.5]{images/voxel_to_choose2.png} 
\caption{Анализ вокселей для двух человек в одной и той же зоне.}
\label{voxel_to_choose}
\end{figure}

Можно выделить слова, со смыслом "действительно", а также глаголы. Продолжая анализировать поучившиеся веса, мы попробовали кластеризовать слова в топе наиболее хорошо предсказываемых вокселей. Были найдены воксели, для которых кластеризуется достаточно хорошо, например: см \ref{sub9_names}, \ref{sub15_names}. На рисунках в нулевом кластере достаточно простые слова: ball, name, miss, high, hot, strong, в первом же много собственных имен: Elvis, Tommy, Danny, Roger. Также точками показана проекция на плоскость с помощью принципа главных компонент, две компоненты объясняют более трети дисперсии, что достаточно много для семантического трехсотмерного представления.

\begin{figure}
\centering
\includegraphics[scale=0.55]{images/sub9_names.png}
\caption{Кластеризация топ 100 слов}
\label{sub9_names}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[scale=0.55]{images/sub15_names.png}
\caption{Кластеризация топ 100 слов.}
\label{sub15_names}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[scale=0.45]{images/demo.png}
\caption{Демо для изучения воксельной избирательности.}
\label{demo}
\end{figure}

Мы создали демо, в котором можно выбрать человека и воксель, и будет показано на какие слова данный воксель имеет наибольший отклик (см. \ref{demo}).

\section{Нейросетевые методы}

\begin{figure}[h]
\centering
\includegraphics[scale=0.5]{graphics/sub3_net.png}
\caption{Результат на тесте в зависимости от архитектуры сети и эпохи обучения.}
\label{nets_scores}
\end{figure}

В первом приближении мы испробовали предсказывать отклик напрямую на основе синтерполированного представления аудиостимула. На графике \ref{nets_scores} показана средняя корреляция Пирсона на тесте в зависимости от эпохи обучения для 1000 наиболее хорошо предсказываемых по результатам гребневой регрессии вокселей. Горизонтальной линией показан результат гребневой регрессии. Видно, что все архитектуры ведут себя не хуже регрессии, при этом лучший результат у рекуррентной сети (1 скрытый слой с 10 gru/lstm). Это можно объяснить тем, что рекуррентные сети лучше улавливают предыдущий контекст, нежели обычные полносвязные сети.

\begin{figure}
\centering
\includegraphics[scale=0.5]{images/lstm-architecture.png}
\caption{Работа сети на примере фразы: Anfagen ist leicht, beharren eine Kunst.}
\label{lstm_architecture}
\end{figure}

Так как данных не очень много для того чтобы обучить более мощную модель, мы испробовали несколько другой подход. 
Мы обучили нейронную сеть (см. \ref{lstm_architecture}) с одним скрытым LSTM слоем размерности 50 и трехсотмерным представлением, проинициализированным предобученным word2vecом, использовавшемся в гребневой регрессии, предсказывать следующее слово на корпусе, состоящем из 13 немецких книг и 200000 статей немецкой Википедии. Статьи Википедии выбирались таким образом, чтобы хотя бы одна треть слов из статьи присутствовала в аудиостимуле. Генерация батчей для обучения происходила следующим образом: сначала с вероятностью, прямопропорциональной длине статьи или книги выбирался текст из обучающего корпуса, далее случайно выбиралось начало последовательности. Ответом для этой последовательности служила она же, сдвинутая на одно слова вперед.

Далее через эту сеть был пропущен аудиостимул и каждому слову сопоставлялось состояние lstm слоя в момент предсказания следующего слова. Далее новые полученные представления также интерполировались и конкатенировались и на основе их предсказывался отклик 1000 наиболее хорошо предсказываемых вокселей по результатам гребневой регрессии.
Оказалось, что данное представление дает результат не хуже гребневой регрессии, при этом использует стомерное семантическое  пространство, а не трехсотмерное.

\clearpage
\section{Избирательность в нейросетевых подходах}

Далее мы попробовали проинтерпретировать веса гребневой регрессии. Для этого мы рассмотрели тот lstm unit, вес которого по модулю наибольший и посмотрели его активации на слова из аудиостимула. Оказалось, что наибольшая активациия достигается на собственный именах (см \ref{lstm_activation}).

\vspace{1.5cm}

\begin{figure}[h!]
\includegraphics[scale=0.5]{images/text_crop_wb.png}
\caption{Активации рекуррентного нейрона на слова аудиостимула. Наибольшие активации выделены жирным шрифтом.}
\label{lstm_activation}
\end{figure}

\chapter{Сравнение моделей}

В следующей таблице представлено сравнение моделей по нескольким субъектам. Метод, использовавший скрытое состояние LSTM сети, показывает результаты не хуже гребневой регрессии, при этом обучаемых параметров у него меньше. Нейросети, предсказывающие отклик напрямую, в целом показывают результаты чуть луше гребневой регрессии, несмотря на большое число обучаемых параметров (использовалась сильная регуляризация и дропаут).

\vspace{1cm}
{\centering
\begin{tabular}{| l | c | c | c | c | r |}
  \hline
  Субъекты /\ Модели & Гребневая регрессия & LSTM(wiki) & GRU(stimulus) & FC(stimulus)\\ \hline  
  Субъект 1 & 0.48  & 0.5  & 0.52 & 0.53\\ \hline
  Субъект 2 & 0.44 & 0.41  & 0.48 & 0.46\\ \hline
  Субъект 3 & 0.43 & 0.45  & 0.47  & 0.46\\ \hline
  Среднее значение & 0.45 & 0.45 & \bf{0.48}  & 0.46\\ \hline
  Число параметров  & 1200 & \bf{400} & 36000 & 12010\\ \hline
\end{tabular}}

\chapter{Заключение}

В заключение хотелось бы отметить несколько выводов, сделанных при работе:

\begin{itemize}
\item Подход, описанный в статье \cite{hanke2014high} воспроизводим на независимых данных и других параметрах эксперимента, при этом предобученный word2vec также показывает неплохие результаты.

\item Зоны, лучше всего предсказываемые моделями, более всего реагируют на собственные имена.

\item Рекуррентные сети показывают результаты чуть лучше гребневой регрессии засчет того, что улавливают контекст.

\item Метод, использующий представление, полученное рекуррентной сети показывает результат не хуже гребневой регрессии, при этом у него в 4 раза меньше обучаемых параметров.
\end{itemize}

\newpage

На защиту выноcятся:
\begin{itemize}
\item Подготовлена экспериментальная среда, позволяющая развивать исследования с данными (\cite{huth2016natural}).
\item Разработана и исследована линейная регрессионная модель BOLD-отклика.
\item Разработан демонстрационный пользовательский интерфейс для исследования семантической избирательности модели.
\item Разработаны и исследованы нелинейные нейросетевые модели BOLD-отклика, в том числе модели на основе полносвязной и рекуррентной нейронных сетях.
\end{itemize}

\bibliography{diplomnaya_rabota}
\bibliographystyle{plain}

\end{document}














